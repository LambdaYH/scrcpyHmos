import { common, Want } from '@kit.AbilityKit';

interface ConfigItem {
  title: ResourceStr;
  desc: ResourceStr;
}

@Entry
@Component
struct ConfigDescPage {

  private openUrl(url: string) {
    const context = this.getUIContext().getHostContext() as common.UIAbilityContext;
    let want: Want = {
      action: 'ohos.want.action.viewData',
      entities: ['entity.system.browsable'],
      uri: url
    };
    context.startAbility(want).catch((err: Error) => {
      console.error('Failed to open URL:', err);
    });
  }

  build() {
    Column() {
      // Header
      Row() {
        Button({ type: ButtonType.Circle, stateEffect: true }) {
          SymbolGlyph($r('sys.symbol.arrow_left'))
            .fontSize(24)
            .fontColor([$r('app.color.text_primary')])
        }
        .width(40)
        .height(40)
        .backgroundColor(Color.Transparent)
        .onClick(() => {
          this.getUIContext().getRouter().back();
        })
        .margin({ right: 12 })

        Text($r('app.string.config_desc_title'))
          .fontSize(20)
          .fontWeight(FontWeight.Bold)
          .fontColor($r('app.color.text_primary'))
      }
      .width('100%')
      .height(56 + 38)
      .padding({ left: 12, right: 24, top: 38 })
      .alignItems(VerticalAlign.Center)

      Scroll() {
        Column({ space: 24 }) {

          Column() {
            Text($r('app.string.help_config_ref'))
              .fontSize(14)
              .fontColor($r('app.color.text_primary'))
              .width('100%')
              .margin({ bottom: 8 })

            Text('https://github.com/Genymobile/scrcpy?tab=readme-ov-file')
              .fontSize(14)
              .fontColor($r('app.color.btn_primary'))
              .width('100%')
              .margin({ bottom: 0 })
              .onClick(() => {
                this.openUrl('https://github.com/Genymobile/scrcpy?tab=readme-ov-file');
              })
          }
          .width('100%')
          
          this.ConfigSection($r('app.string.config_video_settings'), [
            { title: $r('app.string.config_video_codec_title'), desc: $r('app.string.config_video_codec_desc') },
            { title: $r('app.string.config_max_size_title'), desc: $r('app.string.config_max_size_desc') },
            { title: $r('app.string.config_bitrate_title'), desc: $r('app.string.config_bitrate_desc') },
            { title: $r('app.string.config_max_fps_title'), desc: $r('app.string.config_max_fps_desc') },
            { title: $r('app.string.config_crop_title'), desc: $r('app.string.config_crop_desc') }
          ] as ConfigItem[])

          this.ConfigSection($r('app.string.config_audio_settings'), [
            { title: $r('app.string.config_enable_audio_title'), desc: $r('app.string.config_enable_audio_desc') },
            { title: $r('app.string.config_audio_codec_title'), desc: $r('app.string.config_audio_codec_desc') },
            { title: $r('app.string.config_audio_bitrate_title'), desc: $r('app.string.config_audio_bitrate_desc') }
          ] as ConfigItem[])

          this.ConfigSection($r('app.string.config_behavior_settings'), [
            { title: $r('app.string.config_show_touches_title'), desc: $r('app.string.config_show_touches_desc') },
            { title: $r('app.string.config_stay_awake_title'), desc: $r('app.string.config_stay_awake_desc') },
            { title: $r('app.string.config_clipboard_title'), desc: $r('app.string.config_clipboard_desc') }
          ] as ConfigItem[])

          this.ConfigSection($r('app.string.config_connection_actions'), [
            { title: $r('app.string.config_turn_screen_off_connect_title'), desc: $r('app.string.config_turn_screen_off_connect_desc') },
            { title: $r('app.string.config_fullscreen_connect_title'), desc: $r('app.string.config_fullscreen_connect_desc') },
            { title: $r('app.string.config_turn_screen_off_close_title'), desc: $r('app.string.config_turn_screen_off_close_desc') },
            { title: $r('app.string.config_lock_screen_close_title'), desc: $r('app.string.config_lock_screen_close_desc') }
          ] as ConfigItem[])

          this.ConfigSection($r('app.string.config_advanced_options'), [
            { title: $r('app.string.config_downsize_error_title'), desc: $r('app.string.config_downsize_error_desc') },
            { title: $r('app.string.config_connect_start_title'), desc: $r('app.string.config_connect_start_desc') },
            { title: $r('app.string.config_server_log_title'), desc: $r('app.string.config_server_log_desc') }
          ] as ConfigItem[])

        }
        .width('100%')
        .padding(16)
        .alignItems(HorizontalAlign.Start)
      }
      .layoutWeight(1)
      .edgeEffect(EdgeEffect.Spring)
    }
    .width('100%')
    .height('100%')
    .backgroundColor($r('app.color.bg_primary'))
    .expandSafeArea([SafeAreaType.SYSTEM], [SafeAreaEdge.TOP, SafeAreaEdge.BOTTOM])
  }

  @Builder
  ConfigSection(title: ResourceStr, items: ConfigItem[]) {
    Column() {
      Text(title)
        .fontSize(18)
        .fontWeight(FontWeight.Bold)
        .fontColor($r('app.color.text_primary'))
        .margin({ bottom: 12 })
        .width('100%')

      ForEach(items, (item: ConfigItem) => {
        Column() {
          Text(item.title)
            .fontSize(16)
            .fontWeight(FontWeight.Medium)
            .fontColor($r('app.color.text_primary'))
            .margin({ bottom: 4 })
            .width('100%')
          
          Text(item.desc)
            .fontSize(14)
            .fontColor($r('app.color.text_secondary'))
            .lineHeight(20)
            .width('100%')
        }
        .margin({ bottom: 16 })
        .alignItems(HorizontalAlign.Start)
      })
    }
    .width('100%')
  }
}
